<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8">
  <title>Qruplarım</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    * {
      -webkit-tap-highlight-color: transparent;
    }
    *:focus,
    *:active,
    *:focus-visible {
      outline: none !important;
      box-shadow: none !important;
    }
    body {
      background-color: #181818;
      color: white;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .group {
      background-color: #282828;
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .group:hover {
      background-color: #333;
    }
    .group img {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      margin-right: 12px;
    }
    .group-name {
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div id="groups"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAiS6VzSxs6tRnYyTuUttSdO5gzQ6osBpc",
      authDomain: "pasyak-group.firebaseapp.com",
      projectId: "pasyak-group",
      storageBucket: "pasyak-group.firebasestorage.app",
      messagingSenderId: "609320402321",
      appId: "1:609320402321:web:0d3322a262fc807f772e30",
      measurementId: "G-93PCBFG9QK",
      databaseURL: "https://pasyak-group-default-rtdb.firebaseio.com"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const params = new URLSearchParams(window.location.search);
    const currentUser = params.get("user");

    const groupContainer = document.getElementById("groups");

    if (!currentUser) {
      groupContainer.innerHTML = "<p>User tapılmadı.</p>";
      throw new Error("User parametri URL-də yoxdur.");
    }

    // Canlı olaraq qrupları dinlə
    onValue(ref(db), (snapshot) => {
      const data = snapshot.val();
      groupContainer.innerHTML = ""; // Əvvəlkiləri təmizlə

      if (!data || !data.groups) {
        groupContainer.innerHTML = "<p>Heç bir qrup tapılmadı.</p>";
        return;
      }

      for (let groupKey in data.groups) {
        const groupRaw = data.groups[groupKey];
        let groupInfo;

        try {
          groupInfo = JSON.parse(groupRaw);
        } catch (e) {
          console.warn("Qrup məlumatı düzgün formatda deyil:", e);
          continue;
        }

        const groupMembers = data[groupKey];
        if (groupMembers && groupMembers[currentUser]) {
          const div = document.createElement("div");
          div.className = "group";
          div.onclick = () => {
            window.location.href = `?user=${encodeURIComponent(currentUser)}&group=${groupKey}`;
          };

          div.innerHTML = `
            <img src="${groupInfo.profile_group}" alt="${groupInfo.name}">
            <div class="group-name">${groupInfo.name}</div>
          `;

          groupContainer.appendChild(div);
        }
      }
    });
  </script>
</body>
</html>
